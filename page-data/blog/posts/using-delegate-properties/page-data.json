{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/posts/using-delegate-properties","result":{"data":{"markdownRemark":{"html":"<h2 id=\"announcement-time\" style=\"position:relative;\"><a href=\"#announcement-time\" aria-label=\"announcement time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Announcement time!</h2>\n<p>After a long hiatus from kMD2PDF, I revved up my engines and began to work on my latest planned feature for the\nproject...</p>\n<p><strong>YAML support!</strong></p>\n<p>Yes, now YAML is in the works and you can now control basic attributes of your exported document using only\n<a href=\"https://jekyllrb.com/docs/front-matter/\">front matter YAML.</a></p>\n<p>This is an incredibly big milestone as this allows anyone to quickly customise their document without having to write a\nsingle line of Kotlin, and with another planned release to create a GUI exporter for markdown documents, this would\ngreatly streamline users' experience.</p>\n<h2 id=\"okay-so-what-are-delegate-properties\" style=\"position:relative;\"><a href=\"#okay-so-what-are-delegate-properties\" aria-label=\"okay so what are delegate properties permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Okay, so what are delegate properties?</h2>\n<p>kMD2PDF introduces a theming engine where you are able to change the entire color scheme of an exported document just by\nspecifying an attribute in code as such</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">val</span> converter <span class=\"token operator\">=</span> markdownConverter <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  settings <span class=\"token punctuation\">{</span>\n    theme <span class=\"token operator\">=</span> Settings<span class=\"token punctuation\">.</span>Theme<span class=\"token punctuation\">.</span>DARK\n  <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"design-considerations\" style=\"position:relative;\"><a href=\"#design-considerations\" aria-label=\"design considerations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design considerations</h3>\n<p>Before building this system, we have to make several consideration</p>\n<ol>\n<li>How do we specify that certain attributes have different configurations depending on the theme?</li>\n<li>How do we allow changes to the theme propagate to each element such that the changes are reflected during the\ndocument creation?</li>\n</ol>\n<h4 id=\"using-singletons\" style=\"position:relative;\"><a href=\"#using-singletons\" aria-label=\"using singletons permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using singletons</h4>\n<p>The second inquiry is rather easy to answer, so we will tackle that issue first - we can store the <code class=\"language-text\">Settings</code> as\n<a href=\"https://en.wikipedia.org/wiki/Singleton_pattern\">singleton</a>, since the state of a singleton is unique and static, as\nlong as the settings are configured before the document is created, then the settings will be chosen during runtime and\nhave the exported document reflect the changes.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">object</span> Settings <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> font <span class=\"token operator\">=</span> <span class=\"token function\">FontFamily</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sans-serif\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> field<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">inline</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">settings</span><span class=\"token punctuation\">(</span>configuration<span class=\"token operator\">:</span> Settings<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> Settings<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>configuration<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Kotlin comes with a language construct to create singletons easily - <code class=\"language-text\">object</code> keyword (read more\n<a href=\"https://kotlinlang.org/docs/reference/object-declarations.html#object-declarations\">here</a>).</p>\n<p>This creates everything we need in a singleton but reduces all the boiler plate that would be involved with creating\nthe singleton, unlike other languages like <a href=\"https://www.geeksforgeeks.org/singleton-class-java/\">Java.</a></p>\n<p>When we update the <code class=\"language-text\">Settings</code> singleton, the changes will reflect with the exported document since the document style is\nlazily generated only up till the latest minute before it gets exported.</p>\n<h4 id=\"multi-value-properties\" style=\"position:relative;\"><a href=\"#multi-value-properties\" aria-label=\"multi value properties permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multi-value properties</h4>\n<p>Now to tackle the hard question, how do we store multiple values in Kotlin? Ideally, what we would want with this system\nis to have a single variable and have that variable store both the dark theme and light theme setting. That is, if we\nhad a single variable <code class=\"language-text\">textColor</code>, we would want to be able to store both the light theme and dark theme settings inside\nthis variable. Depending on the current <code class=\"language-text\">Settings.theme</code> configuration at the time where the stylesheet has to be\ngenerated, the <code class=\"language-text\">textColor</code> variable would return either the configuration for <code class=\"language-text\">DARK</code> theme or <code class=\"language-text\">LIGHT</code> theme.</p>\n<p>Traditionally, we would approach this issue using a class to store the information and have that be the end of things -\nand this was indeed the approach I ended up employing due to certain limitations in that design which I'll discuss.</p>\n<p>However, in Kotlin, there exists a language construct called\n<a href=\"https://kotlinlang.org/docs/reference/delegated-properties.html\">delegated properties</a> where you are able to call an\nobject constructor to initialise a variable and provide it with a base of data. Subsequent times accessing this variable\nmasks the object constructor and will only allow you to access the data type specified by the delegated property. You\ncan think of a delegated object as an object that defaults all variable references to the given <code class=\"language-text\">getValue</code> and\n<code class=\"language-text\">setValue</code> attributes. This effectively means that once you've delegated a property, you are no longer entitled to\nmodifying the object that created the delegate.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token function\">DelegateExample</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> internalValue <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> \n    <span class=\"token operator\">=</span> <span class=\"token string\">\"Internal value is <span class=\"token interpolation\"><span class=\"token delimiter variable\">${</span>internalValue<span class=\"token delimiter variable\">}</span></span>\"</span>\n\n  <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    internalValue <span class=\"token operator\">+=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In the example above, we have created a delegated property that when referenced as a variable (get), will return a\nstring. But when called with an assignment operator (set) will only accept <code class=\"language-text\">Int</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">var</span> value <span class=\"token keyword\">by</span> <span class=\"token function\">DelegateExample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// internalValue = \"\"</span>\n\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>                  <span class=\"token comment\">// Internal value is </span>\nvalue <span class=\"token operator\">=</span> <span class=\"token number\">10</span>                      <span class=\"token comment\">// internalValue = \"10\"</span>\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>                  <span class=\"token comment\">// Internal value is 10</span>\nvalue <span class=\"token operator\">=</span> <span class=\"token number\">5</span>                       <span class=\"token comment\">// internalValue = \"105\"</span>\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>                  <span class=\"token comment\">// Internal value is 105</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>As you can see from, in order to instantiate a delegated property and use the features of <code class=\"language-text\">getValue</code> and <code class=\"language-text\">setValue</code>, we\nhave to set the variable with the <code class=\"language-text\">by</code> keyword. This way, when you have variable references, it will always call the\nrespective <code class=\"language-text\">setValue</code>/<code class=\"language-text\">getValue</code> methods.</p>\n<p>Now that you've had a crash course with delegated properties in Kotlin, can you think of how we can apply this concept\nto our current problem? To recap, we already have established a singleton to manage the configuration across all\nelements - and the configuration we are most interested in is the <code class=\"language-text\">theme</code> attribute which indicates which theme the\ndocument will create. In that case, since the state is singular and shared across the entire program, we can create a\ndelegate property to hold the configuration of all the themes available, and when the time comes to generate the CSS for\nthe document, the delegated property is called and it will return the corresponding attribute for the specific theme\nconfigured during the time of generation (since the document HTML/CSS are generated per call of\n<code class=\"language-text\">MarkdownConverter#convert</code> as opposed to generating them all at once).</p>\n<p>In that case, we can create the delegated property as such:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> CssProperty <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> light<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> dark<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> light<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> fallback<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span>\n    <span class=\"token keyword\">when</span><span class=\"token punctuation\">(</span>Settings<span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      LIGHT <span class=\"token operator\">-></span> light\n      DARK <span class=\"token operator\">-></span> dark\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">?:</span> fallback\n\n  <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span>\n    <span class=\"token keyword\">when</span><span class=\"token punctuation\">(</span>Settings<span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      LIGHT <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n        light <span class=\"token operator\">=</span> value\n      <span class=\"token punctuation\">}</span>\n      DARK <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n        dark <span class=\"token operator\">=</span> value\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This way, we can create a <code class=\"language-text\">CssProperty</code> to hold the configurations required for each theme (light/dark for now) and then\nwhen the variables are accessed, they will return the corresponding value stored depending on the current theme\nconfigured in the settings. The <code class=\"language-text\">fallback</code> property is a \"default\" for each <code class=\"language-text\">CssProperty</code> in the event where the <code class=\"language-text\">light</code>\nor <code class=\"language-text\">dark</code> property are both set to null.</p>\n<p>To use the <code class=\"language-text\">CssProperty</code> class, we will use the following syntax:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">var</span> textColor <span class=\"token keyword\">by</span> CssProperty<span class=\"token operator\">&lt;</span>FontFamily<span class=\"token operator\">?</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fa\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>textColor<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Light theme text color -> #000000</span>\nSettings<span class=\"token punctuation\">.</span>theme <span class=\"token operator\">=</span> Settings<span class=\"token punctuation\">.</span>Theme<span class=\"token punctuation\">.</span>DARK\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>textColor<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Dark theme text color  -> #fafafa</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>And this provides us with such a convenient interface to modify the values of the configured properties and to quickly\nchange the theme settings for each element on a whim.</p>\n<h2 id=\"roadblocks-\" style=\"position:relative;\"><a href=\"#roadblocks-\" aria-label=\"roadblocks  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Roadblocks 😢</h2>\n<p>However, when attempting to create the YAML feature, I had noticed a huge flaw in the delegate property system used for\nconfiguring the style components. Since the YAML formatting had to be rendered during runtime and as such, the YAML had\nto modify the existing style which while possible using the Singleton pattern, certain components like relying on a\nfallback would not be able to register the changes made. Therefore, I had to revert to using a simple class to house the\nCSS properties of an element and convert the Settings singleton to be a regular object that has to be passed to each\nelement for the configuration to take place.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> CssProperty<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">val</span> theme<span class=\"token operator\">:</span> Settings<span class=\"token punctuation\">.</span>Theme<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> light<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> dark<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> light<span class=\"token punctuation\">,</span> \n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> fallback<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n  <span class=\"token keyword\">var</span> value<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span>\n    <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">when</span><span class=\"token punctuation\">(</span>theme<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      LIGHT <span class=\"token operator\">-></span> light\n      DARK <span class=\"token operator\">-></span> dark\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">?:</span> fallback\n\n    <span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      light <span class=\"token operator\">=</span> input\n      dark <span class=\"token operator\">=</span> input\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then in order for the converter to apply the changes of the YAML to the document being generated, we iterate over every\nelement within the style and apply the changes accordingly. </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> List<span class=\"token operator\">&lt;</span>Element<span class=\"token operator\">></span><span class=\"token punctuation\">.</span><span class=\"token function\">updateStyles</span><span class=\"token punctuation\">(</span>input<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> update<span class=\"token operator\">:</span> Element<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>T<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  input<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">let</span> <span class=\"token punctuation\">{</span> forEach <span class=\"token punctuation\">{</span> e <span class=\"token operator\">-></span> e<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span>  <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The lesson learnt here is that while a structure might look good on paper and work for a specific use case, this might\nnot always be the case and this can result in rewriting of the codebase. I was lucky that the codebase was one that I\nwas very familiar with and I could afford the rewrite to get this new feature up and running. However, I would not\nalways be so lucky and might encounter a codebase that might take too long to rewrite.</p>","frontmatter":{"title":"Applications of Kotlin's delegate properties","date":"13 July 2019","description":"Exploring delegate properties while trying to improve the usability of kMD2PDF - a simple markdown to PDF converter","tags":["Kotlin","tutorial","guide","delegates","kMD2PDF"]},"fields":{"slug":"/blog/posts/using-delegate-properties"}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/blog/posts/heroku-x-docker-x-discord-bot-x-kotlin"},"frontmatter":{"title":"Heroku x Docker x Discord bot x Kotlin","published":true}}},{"node":{"fields":{"slug":"/blog/posts/porting-to-flexmark"},"frontmatter":{"title":"Porting to FlexMark","published":true}}}]}},"pageContext":{"slug":"/blog/posts/using-delegate-properties","next":"/blog/posts/heroku-x-docker-x-discord-bot-x-kotlin","prev":"/blog/posts/porting-to-flexmark"}},"staticQueryHashes":["2068778362","2207116114"]}