<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.5625 'Source Sans Pro',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Source Sans Pro',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;color:hsla(0,0%,0%,1);font-family:'Source Serif Pro',sans-serif;font-weight:600;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;color:hsla(0,0%,0%,1);font-family:'Source Serif Pro',sans-serif;font-weight:600;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;color:hsla(0,0%,0%,1);font-family:'Source Serif Pro',sans-serif;font-weight:600;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;color:hsla(0,0%,0%,1);font-family:'Source Serif Pro',sans-serif;font-weight:600;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;color:hsla(0,0%,0%,1);font-family:'Source Serif Pro',sans-serif;font-weight:600;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;color:hsla(0,0%,0%,1);font-family:'Source Serif Pro',sans-serif;font-weight:600;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}ul{margin-left:1.5625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.5625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;font-size:0.85rem;line-height:1.5625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;font-size:1rem;line-height:1.5625rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}blockquote{margin-left:0;margin-right:1.5625rem;margin-top:0;padding-bottom:0;padding-left:1.75781rem;padding-right:0;padding-top:0;margin-bottom:1.5625rem;font-size:1.1487rem;line-height:1.5625rem;color:hsla(0,0%,0%,0.59);border-left:0.58594rem solid;border-color:#fcea0e;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.5625rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5625rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.5625rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.5625rem;margin-bottom:calc(1.5625rem / 2);margin-top:calc(1.5625rem / 2);}li > ul{margin-left:1.5625rem;margin-bottom:calc(1.5625rem / 2);margin-top:calc(1.5625rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.5625rem / 2);}code{font-size:0.85rem;line-height:1.5625rem;}kbd{font-size:0.85rem;line-height:1.5625rem;}samp{font-size:0.85rem;line-height:1.5625rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.04167rem;padding-right:1.04167rem;padding-top:0.78125rem;padding-bottom:calc(0.78125rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#fb251b;text-decoration:none;}a:hover,a:active{color:hsla(0,0%,0%,0.8);}h1,h2,h3,h4,h5,h6{margin-top:3.125rem;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.5625rem;color:hsla(0,0%,0%,0.8);font-weight:400;}blockquote cite:before{content:"â€” ";}@media only screen and (max-width:480px){blockquote{margin-left:-1.17188rem;margin-right:0;border-left:0.29297rem solid;border-color:#fcea0e;padding-left:0.87891rem;}}</style><style data-href="/styles.ab403e5752b1bbf8c895.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}code[class*=language-],pre[class*=language-]{font-family:IBM Plex Mono,monospace;font-size:.8rem}#___gatsby,body{overflow-y:hidden}html{overflow-y:auto}.layout-module--layout--WT_lX{margin:3rem auto;max-width:900px}header{display:flex;align-items:center;justify-items:center;justify-content:space-between}header h3{margin:0}header nav{align-self:end;justify-self:end}header nav a:not(:last-child){margin-right:15px}.blog-post-module--subtitle--2sM_R{margin-top:0;color:grey}.blog-post-module--navigation--7jnCO hr{margin-top:30px}.blog-post-module--navigation--7jnCO .blog-post-module--buttons--1grSi{display:flex;justify-content:space-between}.blog-post-module--navigation--7jnCO .blog-post-module--buttons--1grSi p{display:flex;max-width:450px;padding:8px 15px;background-color:hsla(0,0%,82.7%,.7);border-radius:5px}.blog-post-module--navigation--7jnCO .blog-post-module--buttons--1grSi p a{display:flex;align-items:center;color:#000}.blog-module--subtitle--xfOH7{display:flex;justify-content:space-between}.blog-module--subtitle--xfOH7 h2{margin-top:0;margin-bottom:15px;color:grey}.index-module--home-container--3gShE{height:100vh;margin:0 auto;max-width:700px;display:flex;align-items:center;justify-items:center}.index-module--main-container--2f8vf{margin-right:30px}.index-module--contact--1t6Ht,.index-module--links--3i00D{display:flex}.index-module--contact--1t6Ht a:not(:last-child),.index-module--links--3i00D a:not(:last-child),strong{margin-right:15px}</style><meta name="generator" content="Gatsby 2.20.14"/><link href="//fonts.googleapis.com/css?family=Source+Serif+Pro:600|Source+Sans+Pro:400,400i,700" rel="stylesheet" type="text/css"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/ibmplexmono/v5/-F63fjptAgt5VM-kVkqdyU8n1i8q1w.woff2"/><style type="text/css">@font-face{font-family:'IBM Plex Mono';font-style:normal;font-weight:400;src:local('IBM Plex Mono'),local('IBMPlexMono'),url(/google-fonts/s/ibmplexmono/v5/-F63fjptAgt5VM-kVkqdyU8n1i8q1w.woff2) format('woff2'),url(/google-fonts/s/ibmplexmono/v5/-F63fjptAgt5VM-kVkqdyU8n1i8q0Q.woff) format('woff');font-display: swap;}</style><link as="script" rel="preload" href="/webpack-runtime-64d316546b7fcee2bae4.js"/><link as="script" rel="preload" href="/framework-f2db165fb1960f050581.js"/><link as="script" rel="preload" href="/app-d847b17ed20fa5327bf3.js"/><link as="script" rel="preload" href="/styles-0dd9b16d06f2e4f550cc.js"/><link as="script" rel="preload" href="/1bfc9850-0f929562e553774eb0e4.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-9d6c86f7dc616c192232.js"/><link as="fetch" rel="preload" href="/page-data/blog/posts/2019-07-13-Using Delegate Properties/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--layout--WT_lX"><header><a href="/"><h3>A Programmer&#x27;s Perspective</h3></a><nav><a href="/blog">Blog</a><a href="/projects">Projects</a><a href="/about">About Me</a><a href="/recommendations">Recommendations</a></nav></header><div><h1>Applications of Kotlin&#x27;s delegate properties</h1><h4 class="blog-post-module--subtitle--2sM_R">Published on: <!-- -->13 July 2019</h4><div><h2>Announcement time!</h2>
<p>After a long hiatus from kMD2PDF, I revved up my engines and began to work on my latest planned feature for the
project...</p>
<p><strong>YAML support!</strong></p>
<p>Yes, now YAML is in the works and you can now control basic attributes of your exported document using only
<a href="https://jekyllrb.com/docs/front-matter/">front matter YAML.</a></p>
<p>This is an incredibly big milestone as this allows anyone to quickly customise their document without having to write a
single line of Kotlin, and with another planned release to create a GUI exporter for markdown documents, this would
greatly streamline users' experience.</p>
<h2>Okay, so what are delegate properties?</h2>
<p>kMD2PDF introduces a theming engine where you are able to change the entire color scheme of an exported document just by
specifying an attribute in code as such</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">val</span> converter <span class="token operator">=</span> markdownConverter <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  settings <span class="token punctuation">{</span>
    theme <span class="token operator">=</span> Settings<span class="token punctuation">.</span>Theme<span class="token punctuation">.</span>DARK
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Design considerations</h3>
<p>Before building this system, we have to make several consideration</p>
<ol>
<li>How do we specify that certain attributes have different configurations depending on the theme?</li>
<li>How do we allow changes to the theme propagate to each element such that the changes are reflected during the
document creation?</li>
</ol>
<h4>Using singletons</h4>
<p>The second inquiry is rather easy to answer, so we will tackle that issue first - we can store the <code class="language-text">Settings</code> as
<a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a>, since the state of a singleton is unique and static, as
long as the settings are configured before the document is created, then the settings will be chosen during runtime and
have the exported document reflect the changes.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">object</span> Settings <span class="token punctuation">{</span>
  <span class="token keyword">var</span> font <span class="token operator">=</span> <span class="token function">FontFamily</span><span class="token punctuation">(</span><span class="token string">"sans-serif"</span><span class="token punctuation">)</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token function">settings</span><span class="token punctuation">(</span>configuration<span class="token operator">:</span> Settings<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span> <span class="token operator">=</span> Settings<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Kotlin comes with a language construct to create singletons easily - <code class="language-text">object</code> keyword (read more
<a href="https://kotlinlang.org/docs/reference/object-declarations.html#object-declarations">here</a>).</p>
<p>This creates everything we need in a singleton but reduces all the boiler plate that would be involved with creating
the singleton, unlike other languages like <a href="https://www.geeksforgeeks.org/singleton-class-java/">Java.</a></p>
<p>When we update the <code class="language-text">Settings</code> singleton, the changes will reflect with the exported document since the document style is
lazily generated only up till the latest minute before it gets exported.</p>
<h4>Multi-value properties</h4>
<p>Now to tackle the hard question, how do we store multiple values in Kotlin? Ideally, what we would want with this system
is to have a single variable and have that variable store both the dark theme and light theme setting. That is, if we
had a single variable <code class="language-text">textColor</code>, we would want to be able to store both the light theme and dark theme settings inside
this variable. Depending on the current <code class="language-text">Settings.theme</code> configuration at the time where the stylesheet has to be
generated, the <code class="language-text">textColor</code> variable would return either the configuration for <code class="language-text">DARK</code> theme or <code class="language-text">LIGHT</code> theme.</p>
<p>Traditionally, we would approach this issue using a class to store the information and have that be the end of things -
and this was indeed the approach I ended up employing due to certain limitations in that design which I'll discuss.</p>
<p>However, in Kotlin, there exists a language construct called
<a href="https://kotlinlang.org/docs/reference/delegated-properties.html">delegated properties</a> where you are able to call an
object constructor to initialise a variable and provide it with a base of data. Subsequent times accessing this variable
masks the object constructor and will only allow you to access the data type specified by the delegated property. You
can think of a delegated object as an object that defaults all variable references to the given <code class="language-text">getValue</code> and
<code class="language-text">setValue</code> attributes. This effectively means that once you've delegated a property, you are no longer entitled to
modifying the object that created the delegate.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">class</span> <span class="token function">DelegateExample</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">var</span> internalValue <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">getValue</span><span class="token punctuation">(</span>thisRef<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span> property<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">)</span> 
    <span class="token operator">=</span> <span class="token string">"Internal value is <span class="token interpolation"><span class="token delimiter variable">${</span>internalValue<span class="token delimiter variable">}</span></span>"</span>

  <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">setValue</span><span class="token punctuation">(</span>thisRef<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span> property<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">,</span> value<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    internalValue <span class="token operator">+=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>In the example above, we have created a delegated property that when referenced as a variable (get), will return a
string. But when called with an assignment operator (set) will only accept <code class="language-text">Int</code>.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">var</span> value <span class="token keyword">by</span> <span class="token function">DelegateExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// internalValue = ""</span>

<span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>                  <span class="token comment">// Internal value is </span>
value <span class="token operator">=</span> <span class="token number">10</span>                      <span class="token comment">// internalValue = "10"</span>
<span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>                  <span class="token comment">// Internal value is 10</span>
value <span class="token operator">=</span> <span class="token number">5</span>                       <span class="token comment">// internalValue = "105"</span>
<span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>                  <span class="token comment">// Internal value is 105</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>As you can see from, in order to instantiate a delegated property and use the features of <code class="language-text">getValue</code> and <code class="language-text">setValue</code>, we
have to set the variable with the <code class="language-text">by</code> keyword. This way, when you have variable references, it will always call the
respective <code class="language-text">setValue</code>/<code class="language-text">getValue</code> methods.</p>
<p>Now that you've had a crash course with delegated properties in Kotlin, can you think of how we can apply this concept
to our current problem? To recap, we already have established a singleton to manage the configuration across all
elements - and the configuration we are most interested in is the <code class="language-text">theme</code> attribute which indicates which theme the
document will create. In that case, since the state is singular and shared across the entire program, we can create a
delegate property to hold the configuration of all the themes available, and when the time comes to generate the CSS for
the document, the delegated property is called and it will return the corresponding attribute for the specific theme
configured during the time of generation (since the document HTML/CSS are generated per call of
<code class="language-text">MarkdownConverter#convert</code> as opposed to generating them all at once).</p>
<p>In that case, we can create the delegated property as such:</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">class</span> CssProperty <span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">var</span> light<span class="token operator">:</span> T<span class="token operator">?</span><span class="token punctuation">,</span>
  <span class="token keyword">private</span> <span class="token keyword">var</span> dark<span class="token operator">:</span> T<span class="token operator">?</span> <span class="token operator">=</span> light<span class="token punctuation">,</span>
  <span class="token keyword">private</span> <span class="token keyword">var</span> fallback<span class="token operator">:</span> T<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">getValue</span><span class="token punctuation">(</span>thisRef<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span> property<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">when</span><span class="token punctuation">(</span>Settings<span class="token punctuation">.</span>theme<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      LIGHT <span class="token operator">-></span> light
      DARK <span class="token operator">-></span> dark
    <span class="token punctuation">}</span> <span class="token operator">?:</span> fallback

  <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token function">setValue</span><span class="token punctuation">(</span>thisRef<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span> property<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">,</span> value<span class="token operator">:</span> T<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">when</span><span class="token punctuation">(</span>Settings<span class="token punctuation">.</span>theme<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      LIGHT <span class="token operator">-></span> <span class="token punctuation">{</span>
        light <span class="token operator">=</span> value
      <span class="token punctuation">}</span>
      DARK <span class="token operator">-></span> <span class="token punctuation">{</span>
        dark <span class="token operator">=</span> value
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This way, we can create a <code class="language-text">CssProperty</code> to hold the configurations required for each theme (light/dark for now) and then
when the variables are accessed, they will return the corresponding value stored depending on the current theme
configured in the settings. The <code class="language-text">fallback</code> property is a "default" for each <code class="language-text">CssProperty</code> in the event where the <code class="language-text">light</code>
or <code class="language-text">dark</code> property are both set to null.</p>
<p>To use the <code class="language-text">CssProperty</code> class, we will use the following syntax:</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">var</span> textColor <span class="token keyword">by</span> CssProperty<span class="token operator">&lt;</span>FontFamily<span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token string">"00"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token string">"fa"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>textColor<span class="token punctuation">)</span> <span class="token comment">// Light theme text color -> #000000</span>
Settings<span class="token punctuation">.</span>theme <span class="token operator">=</span> Settings<span class="token punctuation">.</span>Theme<span class="token punctuation">.</span>DARK
<span class="token function">print</span><span class="token punctuation">(</span>textColor<span class="token punctuation">)</span> <span class="token comment">// Dark theme text color  -> #fafafa</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>And this provides us with such a convenient interface to modify the values of the configured properties and to quickly
change the theme settings for each element on a whim.</p>
<h2>Roadblocks ðŸ˜¢</h2>
<p>However, when attempting to create the YAML feature, I had noticed a huge flaw in the delegate property system used for
configuring the style components. Since the YAML formatting had to be rendered during runtime and as such, the YAML had
to modify the existing style which while possible using the Singleton pattern, certain components like relying on a
fallback would not be able to register the changes made. Therefore, I had to revert to using a simple class to house the
CSS properties of an element and convert the Settings singleton to be a regular object that has to be passed to each
element for the configuration to take place.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">class</span> CssProperty<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>
  <span class="token keyword">val</span> theme<span class="token operator">:</span> Settings<span class="token punctuation">.</span>Theme<span class="token punctuation">,</span>
  <span class="token keyword">private</span> <span class="token keyword">var</span> light<span class="token operator">:</span> T<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token keyword">private</span> <span class="token keyword">var</span> dark<span class="token operator">:</span> T<span class="token operator">?</span> <span class="token operator">=</span> light<span class="token punctuation">,</span> 
  <span class="token keyword">private</span> <span class="token keyword">var</span> fallback<span class="token operator">:</span> T<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">var</span> value<span class="token operator">:</span> T<span class="token operator">?</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>theme<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      LIGHT <span class="token operator">-></span> light
      DARK <span class="token operator">-></span> dark
    <span class="token punctuation">}</span> <span class="token operator">?:</span> fallback

    <span class="token keyword">set</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      light <span class="token operator">=</span> input
      dark <span class="token operator">=</span> input
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Then in order for the converter to apply the changes of the YAML to the document being generated, we iterate over every
element within the style and apply the changes accordingly. </p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> List<span class="token operator">&lt;</span>Element<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">updateStyles</span><span class="token punctuation">(</span>input<span class="token operator">:</span> T<span class="token operator">?</span><span class="token punctuation">,</span> update<span class="token operator">:</span> Element<span class="token punctuation">.</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">-></span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  input<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> forEach <span class="token punctuation">{</span> e <span class="token operator">-></span> e<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>The lesson learnt here is that while a structure might look good on paper and work for a specific use case, this might
not always be the case and this can result in rewriting of the codebase. I was lucky that the codebase was one that I
was very familiar with and I could afford the rewrite to get this new feature up and running. However, I would not
always be so lucky and might encounter a codebase that might take too long to rewrite.</p></div></div><div class="blog-post-module--navigation--7jnCO"><hr/><div class="blog-post-module--buttons--1grSi"><p><a href="/blog/posts/2019-08-31-Heroku x Docker x Discord bot x Kotlin"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" style="margin-right:15px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm116-292H256v-70.9c0-10.7-13-16.1-20.5-8.5L121.2 247.5c-4.7 4.7-4.7 12.2 0 16.9l114.3 114.9c7.6 7.6 20.5 2.2 20.5-8.5V300h116c6.6 0 12-5.4 12-12v-64c0-6.6-5.4-12-12-12z"></path></svg>Heroku x Docker x Discord bot x Kotlin</a></p><p><a href="/blog/posts/2019-04-08-Porting to FlexMark">Porting to FlexMark<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" style="margin-left:15px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zM140 300h116v70.9c0 10.7 13 16.1 20.5 8.5l114.3-114.9c4.7-4.7 4.7-12.2 0-16.9l-114.3-115c-7.6-7.6-20.5-2.2-20.5 8.5V212H140c-6.6 0-12 5.4-12 12v64c0 6.6 5.4 12 12 12z"></path></svg></a></p></div></div><footer>Copyright Â© 2020. A Programmer&#x27;s Perspective is built with Gatsby.js.</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/posts/2019-07-13-Using Delegate Properties";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d847b17ed20fa5327bf3.js"],"component---src-templates-project-listing-js":["/component---src-templates-project-listing-js-3b206a1082ffd4cf6552.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-9d6c86f7dc616c192232.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-efe132b5a0e2c243a552.js"],"component---src-pages-index-js":["/component---src-pages-index-js-892869884ebe147b7eca.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-a44561343fd739e7058c.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-9d6c86f7dc616c192232.js" async=""></script><script src="/1bfc9850-0f929562e553774eb0e4.js" async=""></script><script src="/styles-0dd9b16d06f2e4f550cc.js" async=""></script><script src="/app-d847b17ed20fa5327bf3.js" async=""></script><script src="/framework-f2db165fb1960f050581.js" async=""></script><script src="/webpack-runtime-64d316546b7fcee2bae4.js" async=""></script></body></html>