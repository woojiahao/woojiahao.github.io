<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.3a997664b0601c27d93f.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}*{margin:0;padding:0}h1,h2,h3,h4,h5,h6{position:relative;font-family:var(--heading-font);margin:1em 0;font-weight:700}.anchor.before{fill:var(--fg-color)}#___gatsby,#gatsby-focus-wrapper,body,html{height:100%}body{--link-color:#ff5964;--bg-color:#fdfffc;--fg-color:#2b2d42;--base-unit:16px;--dark-text:#141414;--heading-font:"Lato","Open Sans","Montserrat",sans-serif;--body-font:"Open Sans",Avenir,Helvetica,Arial,sans-serif;--gray:#616161;--shadow:#eee 5px 5px 8px;--pagination-background:#fafafa;--pagination-active-background:#f5f5f5;--blur:5px;background-color:var(--bg-color);color:var(--fg-color);font-size:var(--base-unit);font-family:var(--body-font);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transition:background-color .5s}body.dark{--link-color:#83bcff;--bg-color:#2b2d42;--fg-color:#fdfffc;--gray:#bdbdbd;--shadow:none;--pagination-background:#212121;--pagination-active-background:#424242;--blur:0px}p{line-height:25px;margin-bottom:2em}a{color:var(--link-color);font-weight:700;text-decoration:none}li a,p a{background:linear-gradient(180deg,var(--link-color) 0,var(--link-color)) repeat-x 0 100%;background-size:4px 2px;transition:all .3s}li a:hover,p a:hover{background-size:4px 50px;color:var(--fg-color)}ol,ul{margin-bottom:2em}ol li:not(:last-child),ul li:not(:last-child){margin-bottom:.5em}blockquote{position:relative;display:block;color:var(--gray);margin-bottom:2rem;padding:.5rem 0;font-size:1.5rem}blockquote p:last-child{padding:0;margin:0}blockquote:before{position:absolute;content:"";top:0;bottom:0;left:-5%;width:10px;background-color:var(--link-color)}blockquote p{line-height:2rem}.video-container{position:relative;width:100%;height:0;padding-bottom:56.25%;margin-bottom:1.5625rem}.video{position:absolute;top:0;left:0;width:100%;height:100%}code[class*=language-],pre[class*=language-]{font-family:IBM Plex Mono,Source Code Pro,monospace}hr{color:var(--fg-color);margin:15px 0}@media screen and (max-width:1024px){body{--base-unit:15px}p{line-height:22px}}@media screen and (max-width:768px){body{--base-unit:14px}p{line-height:20px}blockquote{width:90%;margin:0 auto 2em}blockquote:before{width:5px}}@media screen and (max-width:512px){body{--base-unit:13px}p{line-height:18px}}.layout-module--layout--WT_lX{margin:3rem auto;max-width:900px}header{display:flex;align-items:center;justify-items:center;justify-content:space-between}header h3{margin:0;padding:0;color:var(--fg-color)}header nav{align-self:end;justify-self:end}header nav a:not(:last-child){margin-right:15px}.layout-module--title--2pFnw{display:flex;justify-content:space-between;align-items:center}@media screen and (max-width:1024px){.layout-module--layout--WT_lX{max-width:700px}}@media screen and (max-width:768px){.layout-module--layout--WT_lX{max-width:500px}header{flex-direction:column;align-items:center;justify-content:center}header nav{align-self:center;justify-self:center;margin-top:15px}}@media screen and (max-width:512px){.layout-module--layout--WT_lX{max-width:400px}}@media screen and (max-width:420px){.layout-module--layout--WT_lX{max-width:300px}}.back-to-top-module--arrow--154X5{position:fixed;bottom:0;right:0;display:inline-flex;border-radius:3px;padding:5px 15px 15px 5px}.back-to-top-module--arrow--154X5:hover{cursor:pointer}.back-to-top-module--hidden--1vCrd{visibility:collapse}@media screen and (max-width:768px){.back-to-top-module--arrow--154X5{visibility:collapse}}.index-module--home-container--3gShE{height:100%;margin:0 auto;max-width:700px;display:flex;align-items:center;justify-items:center}.index-module--main-container--2f8vf{margin-right:30px}.index-module--contact--1t6Ht,.index-module--links--3i00D{display:flex}.index-module--links--3i00D{margin-bottom:15px}.index-module--contact--1t6Ht a:not(:last-child),.index-module--contact--1t6Ht strong,.index-module--links--3i00D a:not(:last-child),.index-module--links--3i00D strong{margin-right:15px}@media screen and (max-width:768px){.index-module--home-container--3gShE{max-width:500px}}@media screen and (max-width:512px){.index-module--home-container--3gShE{max-width:400px}.index-module--contact--1t6Ht,.index-module--links--3i00D{flex-direction:column}.index-module--links--3i00D{margin-bottom:15px}}@media screen and (max-width:420px){.index-module--home-container--3gShE{max-width:300px}}.theme-toggle-module--theme-toggle--2rW1R:hover{cursor:pointer}.blog-list-module--general-title--3jaRk{display:flex;justify-content:space-between;align-items:center}.blog-list-module--blog-card--2Ax1S a h2{margin:0;padding:0}.blog-list-module--blog-card--2Ax1S a{text-decoration:none}.blog-list-module--subtitle--1zpXO{display:flex;justify-content:space-between}.blog-list-module--subtitle--1zpXO h3{margin:1em 0;color:var(--gray);padding:0}.blog-list-module--tags--3gLhP{display:flex;flex-wrap:wrap}.blog-list-module--tags--3gLhP div{display:flex;padding:5px 10px;background-color:#e0f2f1;border-radius:5px;align-items:center;justify-content:center;margin-bottom:15px}.blog-list-module--tags--3gLhP div span{color:#424242}.blog-list-module--tags--3gLhP div svg{margin-right:5px}.blog-list-module--tags--3gLhP div:not(:last-child){margin-right:10px}.blog-post-module--subtitle--2sM_R{margin-top:0;color:var(--gray)}.blog-post-module--tags--3p1cR h4{display:flex;flex-wrap:wrap;margin-bottom:10px}.blog-post-module--tags--3p1cR h4 svg{margin-right:15px}.blog-post-module--tags-container--1xoUV{display:flex;flex-wrap:wrap}.blog-post-module--tags--3p1cR span{padding:5px 10px;background-color:#5bc0be;color:var(--fg-color);border-radius:5px;margin-bottom:10px}.blog-post-module--tags--3p1cR span:not(:last-child){margin-right:10px}.project-list-module--project-title--3yIse{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.project-list-module--project-title--3yIse h2{margin:0}.project-list-module--language--1bZRd,.project-list-module--status--3zrNb{border-radius:3px;padding:5px}.project-list-module--language--1bZRd{background-color:rgba(181,144,202,.4)}span.project-list-module--language--1bZRd{margin-right:15px}.project-list-module--description--1c2ws{margin-bottom:15px}@media screen and (max-width:420px){.project-list-module--project-title--3yIse{flex-direction:column;align-items:start}.project-list-module--project-title--3yIse h2{margin-bottom:15px}}.post-list-pagination-module--paginator--1HQ9a{margin-top:15px;display:flex;justify-content:center}.post-list-pagination-module--active-page--FR7mU{background-color:var(--pagination-active-background)}.post-list-pagination-module--paginator--1HQ9a div{display:flex;flex-direction:row;align-content:center;align-items:center;justify-content:center}.post-list-pagination-module--page-number--14Qfw{display:inline-flex;padding:3px 10px;border:1px solid #e0e0e0}.post-list-pagination-module--page-number--14Qfw:hover{background-color:var(--pagination-background)}.project-listing-module--content--38tNg h2,.project-listing-module--content--38tNg h3{margin-top:0}.project-listing-module--links--3hJUU{display:flex;flex-direction:column;margin-bottom:15px}.project-listing-module--links--3hJUU a:not(:last-child){margin-bottom:15px}.project-listing-module--content--38tNg{display:flex;justify-content:space-between}.project-listing-module--sidebar--38aRC{flex-basis:30%}.project-listing-module--main-content--3BMlI{flex-basis:60%}@media screen and (max-width:512px){.project-listing-module--content--38tNg{flex-direction:column}}.image-carousel-module--carousel-container--1tyxZ{position:relative;box-shadow:var(--shadow);margin-bottom:30px}.image-carousel-module--carousel--2Xg0b{position:relative}.image-carousel-module--background-image--1RgHi{position:absolute;height:500px;top:0;width:100%;overflow:hidden;-webkit-filter:blur(var(--blur));filter:blur(var(--blur))}.image-carousel-module--foreground-image--157Xf{display:flex;justify-content:center}.image-carousel-module--navigation-container--3K-72{position:absolute;top:0;bottom:0;left:0;right:0;display:flex;align-items:center;justify-content:center}.image-carousel-module--navigation--1gega{width:100%;display:flex;justify-content:space-between}.image-carousel-module--navigation--1gega div{padding:15px}.image-carousel-module--navigation--1gega div:hover{cursor:pointer}@media screen and (max-width:768px){.image-carousel-module--background-image--1RgHi,.image-carousel-module--carousel-container--1tyxZ,.image-carousel-module--foreground-image--157Xf,.image-carousel-module--foreground-image--157Xf img{max-height:300px;max-height:200px}}.post-navigation-module--navigation--3VtCO .post-navigation-module--buttons--CZBoe{display:flex;justify-content:space-between}.post-navigation-module--navigation--3VtCO .post-navigation-module--buttons--CZBoe p{display:flex;max-width:450px;border-radius:5px;margin-bottom:0}.post-navigation-module--navigation--3VtCO .post-navigation-module--buttons--CZBoe p a{display:flex;align-items:center;color:var(--textTitle);background:none}@media screen and (max-width:768px){.post-navigation-module--navigation--3VtCO .post-navigation-module--buttons--CZBoe{flex-direction:column}.post-navigation-module--navigation--3VtCO .post-navigation-module--buttons--CZBoe p:first-child{margin-bottom:15px;align-self:flex-start}.post-navigation-module--navigation--3VtCO .post-navigation-module--buttons--CZBoe p:last-child{align-self:flex-end}}</style><meta name="generator" content="Gatsby 2.20.14"/><title data-react-helmet="true">Heroku x Docker x Discord bot x Kotlin | A Programmer&#x27;s Perspective</title><meta data-react-helmet="true" name="description" content="31 August 2019 - Heroku x Docker x Discord bot x Kotlin - Deploying a JVM-based Discord bot through the Docker integration with Heroku"/><meta data-react-helmet="true" name="image" content="https://woojiahao.github.io/images/icon.png"/><meta data-react-helmet="true" property="keywords" content="tutorial, guide, Kotlin, Heroku, Discord bot, Docker, deployment"/><meta data-react-helmet="true" property="og:url" content="https://woojiahao.github.io/blog/posts/2019-08-31-Heroku x Docker x Discord bot x Kotlin"/><meta data-react-helmet="true" property="og:title" content="Heroku x Docker x Discord bot x Kotlin | A Programmer&#x27;s Perspective"/><meta data-react-helmet="true" property="og:description" content="31 August 2019 - Heroku x Docker x Discord bot x Kotlin - Deploying a JVM-based Discord bot through the Docker integration with Heroku"/><meta data-react-helmet="true" property="og:image" content="https://woojiahao.github.io/images/icon.png"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-164563111-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-164563111-1', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Lato|Rubik|Open+Sans|IBM+Plex+Mono" rel="stylesheet"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="icon" href="/icons/icon-48x48.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="manifest" href="/manifest.webmanifest"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=fa8429e5cae67fee3058ed2c3775a420"/><link as="script" rel="preload" href="/webpack-runtime-280fb773004bbd115daa.js"/><link as="script" rel="preload" href="/framework-84c9287a5714d2d8ce36.js"/><link as="script" rel="preload" href="/app-98f3e2ce45f88b295012.js"/><link as="script" rel="preload" href="/styles-0dd9b16d06f2e4f550cc.js"/><link as="script" rel="preload" href="/0c428ae2-82896d4921773a4c9835.js"/><link as="script" rel="preload" href="/d7eeaac4-97311478b2221ced9c67.js"/><link as="script" rel="preload" href="/95b64a6e-101708775e0f470f9a67.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-2705bb5758577915bf21.js"/><link as="fetch" rel="preload" href="/page-data/blog/posts/2019-08-31-Heroku x Docker x Discord bot x Kotlin/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="layout-module--layout--WT_lX"><label style="position:absolute;right:0;top:0;margin:15px"><input type="checkbox" hidden=""/> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" class="theme-toggle-module--theme-toggle--2rW1R" height="1.25em" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.002 8.002 0 1010.586 10.586z"></path></svg></label><header><a href="/"><h3>A Programmer&#x27;s Perspective</h3></a><nav><a href="/blog">Blog</a><a href="/projects">Projects</a><a href="/about">About Me</a><a href="/recommendations">Recommendations</a></nav></header><div class="layout-module--title--2pFnw"><h1>Heroku x Docker x Discord bot x Kotlin</h1></div><div style="margin-bottom:1em"><div><h4 class="blog-post-module--subtitle--2sM_R">Published on: <!-- -->31 August 2019</h4><div><p>You may be wondering what's up with the over the top, nearly fan-ship name, trust me, I was not on anything when I wrote this.</p>
<p>I simply wanted to write about a playground project I had written to get Docker working with Heroku, specifically in the context of writing a Discord bot in Kotlin.</p>
<p>I made a rather comprehensive guide to go with the project over on GitHub and I wish to share it here as well since it was a rather large milestone.</p>
<p>If you wish to follow along, the sample project is found <a href="https://github.com/woojiahao/discord-docker">here.</a></p>
<p>The project uses Gradle as the build tool for the project. </p>
<h2 id="running-the-docker-image" style="position:relative;"><a href="#running-the-docker-image" aria-label="running the docker image permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running the Docker image</h2>
<h3 id="local" style="position:relative;"><a href="#local" aria-label="local permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Local</h3>
<p>If you're running the bot locally, you should use Docker to package the bot and run the Docker image created. This way, you can test your bot locally with the same environment as your server thanks to Docker!</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build -t discord-docker <span class="token builtin class-name">.</span>
$ docker image <span class="token function">ls</span> <span class="token comment"># Should see the image named "discord-docker"</span>
$ docker run -e <span class="token assign-left variable">BOT_TOKEN</span><span class="token operator">=</span><span class="token operator">&lt;</span>bot token<span class="token operator">></span> -d discord-docker
$ docker container <span class="token function">ls</span> <span class="token comment"># Should see "discord-docker running"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>With Docker, it is as simple as that to get the bot running. </p>
<h3 id="heroku" style="position:relative;"><a href="#heroku" aria-label="heroku permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Heroku</h3>
<p>If you're deploying the bot on Heroku, the steps are actually outlined in the documentation for Docker by Heroku. (<a href="https://devcenter.heroku.com/articles/build-docker-images-heroku-yml">here</a>)</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ heroku stack:set container
$ <span class="token function">git</span> push heroku master</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>And watch as Heroku does its magic!</p>
<h2 id="project-composition" style="position:relative;"><a href="#project-composition" aria-label="project composition permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Project composition</h2>
<h3 id="buildgradle" style="position:relative;"><a href="#buildgradle" aria-label="buildgradle permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">build.gradle</code></h3>
<p>The <code class="language-text">build.gradle</code> straightforward, with the use of the <code class="language-text">shadowJar</code> plugin to create the fat jar required for all library dependency. In order to prevent the exported jar from having differing names, we set the <code class="language-text">archiveName</code> attribute of the plugin to always use the name <code class="language-text">bot.${extension}</code>.</p>
<p>This means that even if we changed the version of the gradle file, the exported jar file is the same name so we don't need to modify our Dockerfile.</p>
<div class="gatsby-highlight" data-language="groovy"><pre style="counter-reset: linenumber NaN" class="language-groovy line-numbers"><code class="language-groovy">plugins <span class="token punctuation">{</span>
  id <span class="token string">'org.jetbrains.kotlin.jvm'</span> version <span class="token string">'1.3.41'</span>
  id <span class="token string">'com.github.johnrengelman.shadow'</span> version <span class="token string">'5.0.0'</span>
<span class="token punctuation">}</span>

sourceCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>
targetCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>

group <span class="token string">'com.github.woojiahao'</span>
version <span class="token string">'1.0-SNAPSHOT'</span>

repositories <span class="token punctuation">{</span>
  <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  maven <span class="token punctuation">{</span> url <span class="token string">'https://jitpack.io'</span> <span class="token punctuation">}</span>
  <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span><span class="token string">''</span>
  implementation <span class="token string gstring">"org.jetbrains.kotlin:kotlin-stdlib-jdk8"</span>
  implementation <span class="token string gstring">"com.gitlab.aberrantfox:Kutils:0.9.17"</span>
<span class="token punctuation">}</span>

compileKotlin <span class="token punctuation">{</span>
  kotlinOptions<span class="token punctuation">.</span>jvmTarget <span class="token operator">=</span> <span class="token string gstring">"1.8"</span>
<span class="token punctuation">}</span>
compileTestKotlin <span class="token punctuation">{</span>
  kotlinOptions<span class="token punctuation">.</span>jvmTarget <span class="token operator">=</span> <span class="token string gstring">"1.8"</span>
<span class="token punctuation">}</span>

sourceSets <span class="token punctuation">{</span>
  main<span class="token punctuation">.</span>java<span class="token punctuation">.</span>srcDirs <span class="token operator">+=</span> <span class="token string">'src/main/kotlin/'</span>
  test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>srcDirs <span class="token operator">+=</span> <span class="token string">'src/test/kotlin/'</span>
<span class="token punctuation">}</span>

jar <span class="token punctuation">{</span>
  manifest <span class="token punctuation">{</span>
    attributes <span class="token string gstring">"Main-Class"</span><span class="token punctuation">:</span> <span class="token string gstring">"BotKt"</span>
  <span class="token punctuation">}</span>

  from <span class="token punctuation">{</span>
    configurations<span class="token punctuation">.</span>compile<span class="token punctuation">.</span>collect <span class="token punctuation">{</span>
      <span class="token function">zipTree</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

shadowJar <span class="token punctuation">{</span>
  <span class="token function">archiveName</span><span class="token punctuation">(</span><span class="token string gstring">"bot.<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>extension<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="dockerfile" style="position:relative;"><a href="#dockerfile" aria-label="dockerfile permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">Dockerfile</code></h3>
<p>The <code class="language-text">Dockerfile</code> is a little more interesting as it makes use of <a href="https://docs.docker.com/v17.09/engine/userguide/eng-image/multistage-build/">multi-stage builds</a> to create a minimal Docker image. </p>
<p>Our first image layer uses the official gradle images. We will label this layer as <code class="language-text">builder</code>. In this layer, our goal is to create the jar file that will contain all our dependencies. We first access the image as the root user and start with our working directory labelled as <code class="language-text">/builder</code>. We then add all of our files into the working directory and finally, we construct the fat jar using the <code class="language-text">gradle shadowJar</code> command.</p>
<p>Then, we create another layer which will be the final layer that goes into the image. We first use the official Alpine linux image for OpenJDK 8. Then we create a working directory for our application labelled <code class="language-text">/app</code>. Then we copy our fat jar from the <code class="language-text">builder</code> layer to the our home directory. As soon as we are done, we then run the command to execute our fat jar and it will cause the Discord bot to launch.</p>
<p>Using Discord allows us to remain Gradle and Java version agnostic. This <code class="language-text">Dockerfile</code> was taken and modified from the following article found <a href="https://www.richyhbm.co.uk/posts/kotlin-docker-spring-oh-my/">here.</a></p>
<div class="gatsby-highlight" data-language="docker"><pre style="counter-reset: linenumber NaN" class="language-docker line-numbers"><code class="language-docker"><span class="token keyword">FROM</span> gradle<span class="token punctuation">:</span>5.6.1<span class="token punctuation">-</span>jdk8 AS builder
<span class="token keyword">USER</span> root
<span class="token keyword">WORKDIR</span> /builder
<span class="token keyword">ADD</span> . /builder
<span class="token keyword">RUN</span> gradle shadowJar

<span class="token keyword">FROM</span> openjdk<span class="token punctuation">:</span>8<span class="token punctuation">-</span>jre<span class="token punctuation">-</span>alpine
<span class="token keyword">WORKDIR</span> /app
<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=builder /builder/build/libs/bot.jar .
<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span> <span class="token string">"-jar"</span><span class="token punctuation">,</span> <span class="token string">"bot.jar"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="herokuyml" style="position:relative;"><a href="#herokuyml" aria-label="herokuyml permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">heroku.yml</code></h3>
<p>The <code class="language-text">heroku.yml</code> file contains the configuration needed for Heroku to run your application. In that sense, it is similar to the traditional <code class="language-text">Procfile</code> that is provided to Heroku applications.</p>
<p>In this scenario, we don't need to use an elaborate <code class="language-text">heroku.yml</code> file, all we need is to specify that the worker dyno will be based off the instructions of the <code class="language-text">Dockerfile</code> and that's all. </p>
<p>If you do need to include information like addons and build steps, you can feel free to do so through the use of the additional properties within the configuration file. More information can be found <a href="https://devcenter.heroku.com/articles/build-docker-images-heroku-yml">here.</a></p>
<div class="gatsby-highlight" data-language="yaml"><pre style="counter-reset: linenumber NaN" class="language-yaml line-numbers"><code class="language-yaml"><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">docker</span><span class="token punctuation">:</span>
    <span class="token key atrule">worker</span><span class="token punctuation">:</span> Dockerfile</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div></div></div><div class="blog-post-module--tags--3p1cR"><div class="blog-post-module--tags-container--1xoUV"><span>tutorial</span><span>guide</span><span>Kotlin</span><span>Heroku</span><span>Discord bot</span><span>Docker</span><span>deployment</span></div></div><div class="post-navigation-module--navigation--3VtCO"><hr/><div class="post-navigation-module--buttons--CZBoe"><p><a href="/blog/posts/2019-09-06-Lessons from Meetup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" style="margin-right:15px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z"></path></svg>Lessons from Meetup (and Docker)</a></p><p><a href="/blog/posts/2019-07-13-Using Delegate Properties">Applications of Kotlin&#x27;s delegate properties<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" style="margin-left:15px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M294.1 256L167 129c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.3 34 0L345 239c9.1 9.1 9.3 23.7.7 33.1L201.1 417c-4.7 4.7-10.9 7-17 7s-12.3-2.3-17-7c-9.4-9.4-9.4-24.6 0-33.9l127-127.1z"></path></svg></a></p></div></div></div><footer>Copyright © 2020. <!-- -->A Programmer&#x27;s Perspective<!-- --> is built with Gatsby.js. The repository can be found <a href="https://github.com/woojiahao/woojiahao.github.io">here.</a></footer></div><div class="back-to-top-module--hidden--1vCrd back-to-top-module--arrow--154X5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1.75em" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M868 545.5L536.1 163a31.96 31.96 0 0 0-48.3 0L156 545.5a7.97 7.97 0 0 0 6 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"></path></svg></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/posts/2019-08-31-Heroku x Docker x Discord bot x Kotlin";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-98f3e2ce45f88b295012.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b3d32bc20641419cfed7.js"],"component---src-templates-blog-list-js":["/component---src-templates-blog-list-js-34617f27f403aad53622.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-2705bb5758577915bf21.js"],"component---src-templates-project-list-js":["/component---src-templates-project-list-js-38b4a84e5d5eae88ee79.js"],"component---src-templates-project-listing-js":["/component---src-templates-project-listing-js-1aebc956c68af2ac7c0a.js"],"component---src-templates-general-post-js":["/component---src-templates-general-post-js-234fe3891d55e0554da4.js"],"component---src-pages-404-js":["/component---src-pages-404-js-1fe03d08a2ce3bfbd7be.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4fc8660b54cfccfb59ae.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-2705bb5758577915bf21.js" async=""></script><script src="/95b64a6e-101708775e0f470f9a67.js" async=""></script><script src="/d7eeaac4-97311478b2221ced9c67.js" async=""></script><script src="/0c428ae2-82896d4921773a4c9835.js" async=""></script><script src="/styles-0dd9b16d06f2e4f550cc.js" async=""></script><script src="/app-98f3e2ce45f88b295012.js" async=""></script><script src="/framework-84c9287a5714d2d8ce36.js" async=""></script><script src="/webpack-runtime-280fb773004bbd115daa.js" async=""></script></body></html>